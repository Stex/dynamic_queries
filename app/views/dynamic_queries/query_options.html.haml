#dynamic_queries
  .page-header
    %h1= dqt('query_options.page_header')
    = render :partial => 'progressbar'
    %pre#generated_sql= @query.valid_sql? ? @query.to_sql : @query.sql_error

  .table-responsive
    %table.table.table-striped.table-bordered
      %thead
        %tr
          %th{:colspan => 2}
          - @query.columns.each do |column|
            %th.text-center= column.name_with_table
      %tbody
        %tr
          %th.text-center= dqt('query_options.table.custom_name')
          %th
          - @query.columns.each do |column|
            %td= text_field_tag :custom_name, column.custom_name, column_options_data(column, :custom_name, :placeholder => column.name, :class => 'form-control input-sm')

        / SELECT
        %tr{:data => {:clause => 'select', :url => dq_url(:set_column_order, @query)}}
          %th.text-center
            = dqt('query_options.table.select')
          %th.text-center= change_order_link
          - @query.columns.each do |column|
            %td.text-center= check_box_tag :show, '1', column.show?, column_options_data(column, :show)
          = render :partial => 'dynamic_queries/query_options/column_order', :locals => {:order_type => 'select'}

        / ORDER BY
        %tr{:data => {:clause => 'order_by', :url => dq_url(:set_column_order, @query)}}
          %th.text-center
            = dqt('query_options.table.order_by')
          %th.text-center= change_order_link
          - @query.columns.each do |column|
            %td.text-center= select_tag :order_by, sort_directions(column), column_options_data(column, :order_by, :class => 'form-control input-sm')
          = render :partial => 'dynamic_queries/query_options/column_order', :locals => {:order_type => 'order_by'}

        / GROUP BY
        %tr
          %th.text-center= dqt('query_options.table.group_by')
          %th
          - @query.columns.each do |column|
            %td.text-center= check_box_tag :group_by, '1', column.group_by?, column_options_data(column, :group_by)

        / Aggregate Functions
        %tr
          %th.text-center= dqt('query_options.table.aggregate_functions')
          %th
          - @query.columns.each do |column|
            %td.text-center
              = select_tag :aggregate_function, aggregate_function_options(column), column_options_data(column, :aggregate_function, :class => 'form-control input-sm')

        / Conditions
        %tr{:style => 'border-top: 2px solid grey;'}
          %th.text-center= dqt('query_options.table.conditions')
          %th
          - @query.columns.each do |column|
            %td{:id => column.dom_id(:conditions)}= render :partial => 'dynamic_queries/query_options/column_conditions', :locals => {:column => column}

        / Condition Arrangement
        %tr
          %th.text-center
            = link_to_function dqt('actions.save'), "dynamicQueries.actions.columnOptions.updateConditionOrder('#{dq_url(:update_condition_order, @query)}')"
          %th
            %ul.list-unstyled
              %li.order-item.query-column-condition.text-center{:data => {:identifier => '()', :connector => true}}= '( )'
              %li.order-item.query-column-condition.text-center{:data => {:identifier => 'and', :connector => true}}= ' AND '
              %li.order-item.query-column-condition.text-center{:data => {:identifier => 'or', :connector => true}}= ' OR '
          %td#condition_order{:colspan => @query.columns.size}
            %p.text-info= dqt('help.condition_order')
            %h4.fancy
              %span WHERE

            %ul.list-inline{:data => {:droppable => 'conditions', 'condition-clause' => 'where'}, :style => 'width: 100%; min-height: 30px;'}
              = render :partial => 'dynamic_queries/query_options/condition_order', :locals => {:conditions => @query.where_conditions}
            %p.text-danger{:style => 'display: none', :data => {'condition-clause' => 'where'}}

            %h4.fancy
              %span HAVING

            %ul.list-inline{:data => {:droppable => 'conditions', 'condition-clause' => 'having'}, :style => 'width: 100%; min-height: 30px;'}
              = render :partial => 'dynamic_queries/query_options/condition_order', :locals => {:conditions => @query.having_conditions}
            %p.text-danger{:style => 'display: none', :data => {'condition-clause' => 'having'}}


  .preview-box
    %h4= dqt('preview')
    .table-responsive
      %table.table.table-hover.table-striped.table-bordered#query_preview
        = render :partial => 'dynamic_queries/query_options/preview'

  #conditions_modal.modal.fade{:tabindex => '-1', :role => :dialog, 'aria-hidden' => :true}


:javascript
  $(document).ready(function() {
    dynamicQueries.actions.columnOptions.init();
  });